
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>zlel.zlel_p1 &#8212; ZLEL 1.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for zlel.zlel_p1</h1><div class="highlight"><pre>
<span></span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">.. module:: zlel_p1.py</span>
<span class="sd">    :synopsis: Module contains the circuit parser,</span>
<span class="sd">      a branch builder, info printing and some integrity checks.</span>

<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">sys</span>


<div class="viewcode-block" id="print_cir_info"><a class="viewcode-back" href="../../zlel.html#zlel.zlel_p1.print_cir_info">[docs]</a><span class="k">def</span> <span class="nf">print_cir_info</span><span class="p">(</span><span class="n">cir_el</span><span class="p">,</span> <span class="n">cir_nd</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">nodes</span><span class="p">,</span> <span class="n">el_num</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Prints the info of the circuit:</span>
<span class="sd">            1.- Elements info</span>
<span class="sd">            2.- Node info</span>
<span class="sd">            3.- Branch info</span>
<span class="sd">            4.- Variable info</span>
<span class="sd">    Args:</span>
<span class="sd">        cir_el: reshaped cir_el</span>
<span class="sd">        cir_nd: reshaped cir_nd. Now it will be a (b,2) matrix</span>
<span class="sd">        b: # of branches</span>
<span class="sd">        n: # number of nodes</span>
<span class="sd">        nodes: an array with the circuit nodes sorted</span>
<span class="sd">        el_num:  the # of elements.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Element info</span>
    <span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">el_num</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; Elements&#39;</span><span class="p">)</span>
    <span class="c1"># Node info</span>
    <span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; Different nodes: &#39;</span> <span class="o">+</span>
          <span class="nb">str</span><span class="p">(</span><span class="n">nodes</span><span class="p">))</span>
    <span class="c1"># Branch info</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; Branches: &quot;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">b</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;. branch:</span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">cir_el</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span>
              <span class="s2">&quot;,</span><span class="se">\t</span><span class="s2">i&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span>
              <span class="s2">&quot;,</span><span class="se">\t</span><span class="s2">v&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span>
              <span class="s2">&quot;=e&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">cir_nd</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span> <span class="o">+</span>
              <span class="s2">&quot;-e&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">cir_nd</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]))</span>

    <span class="c1"># Variable info</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">b</span> <span class="o">+</span> <span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot; variables: &quot;</span><span class="p">)</span>
    <span class="c1"># Print all the nodes but the first (0 because is sorted)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;e&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;, &quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">b</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;i&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;, &quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># Print all the branches but the last to close it properly</span>
    <span class="c1"># It works because the minuimum amount of branches in a circuit must be 2.</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">b</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;v&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;, &quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;v&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">b</span><span class="p">))</span></div>


<span class="c1"># 1) CIR_PARSERRA:</span>
<div class="viewcode-block" id="cir_parser"><a class="viewcode-back" href="../../zlel.html#zlel.zlel_p1.cir_parser">[docs]</a><span class="k">def</span> <span class="nf">cir_parser</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function takes a .cir test circuit and parse it into</span>
<span class="sd">        4 matices.</span>
<span class="sd">        If the file has not the proper dimensions it warns and exit.</span>

<span class="sd">    Args:</span>
<span class="sd">        filename: string with the name of the file</span>

<span class="sd">    Returns:</span>
<span class="sd">        cir_el: np array of strings with the elements to parse. size(1,b)</span>
<span class="sd">        cir_nd: np array with the nodes to the circuit. size(b,4)</span>
<span class="sd">        cir_val: np array with the values of the elements. size(b,3)</span>
<span class="sd">        cir_ctrl: np array of strings with the element which branch</span>
<span class="sd">        controls the controlled sources. size(1,b)</span>

<span class="sd">    Rises:</span>
<span class="sd">        SystemExit</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">cir</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">str</span><span class="p">))</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s2">&quot;File corrupted: .cir size is incorrect.&quot;</span><span class="p">)</span>

    <span class="n">cir_el</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cir</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>

    <span class="n">cir_nd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cir</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">5</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>

    <span class="n">cir_val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cir</span><span class="p">[:,</span> <span class="mi">5</span><span class="p">:</span><span class="mi">8</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

    <span class="n">cir_ctr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cir</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">cir_el</span><span class="p">,</span> <span class="n">cir_nd</span><span class="p">,</span> <span class="n">cir_val</span><span class="p">,</span> <span class="n">cir_ctr</span><span class="p">,</span> <span class="n">cir</span></div>


<span class="c1"># 2) Digrafoa irudikatu: LUZATU</span>
<div class="viewcode-block" id="luzatu"><a class="viewcode-back" href="../../zlel.html#zlel.zlel_p1.luzatu">[docs]</a><span class="k">def</span> <span class="nf">luzatu</span><span class="p">(</span><span class="n">cir_el</span><span class="p">,</span> <span class="n">cir_nd</span><span class="p">,</span> <span class="n">cir_val</span><span class="p">,</span> <span class="n">cir_ctr</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    This function enlarges the cir_el, cir_nd, cir_val and cir_ctr lists in</span>
<span class="sd">    order to take into account al branches of the diodes and the amplifiers.</span>


<span class="sd">    Returns:</span>
<span class="sd">        cir_el_luz, cir_nd_luz, cir_val_luz and cir_ctr_luz.</span>
<span class="sd">        All 4 returned elements are lists again.</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1"># Q:</span>
    <span class="c1"># ezpaiteu kopiak iten elementu berdiñai iteie erreferentzia eta bat</span>
    <span class="c1"># aldatzebada bestea ebai aldatzea</span>
    <span class="n">cir_el2</span> <span class="o">=</span> <span class="n">cir_el</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">cir_nd2</span> <span class="o">=</span> <span class="n">cir_nd</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">cir_val2</span> <span class="o">=</span> <span class="n">cir_val</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">cir_ctr2</span> <span class="o">=</span> <span class="n">cir_ctr</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="c1"># paso aldagaia sortu behar da i!=0 danen matrize berdiñetik</span>
    <span class="c1"># hartzen aigealako eta lerro bat gehio gehitzedeunen</span>
    <span class="c1"># hasierako range(len(cir_el)) hoi baño matrize</span>
    <span class="c1"># haundigok lortzen goazelako</span>
    <span class="n">paso</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cir_el</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">cir_el</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;Q&quot;</span><span class="p">:</span>

            <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">cir_el2</span> <span class="o">=</span> <span class="n">cir_el2</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span> <span class="n">i</span> <span class="o">+</span> <span class="n">paso</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cir_el2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
            <span class="c1"># matrize hutsa behardeu, bestela aurrekoan gañen iteu append</span>
            <span class="n">cir_el2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cir_el2</span><span class="p">,</span> <span class="n">cir_el</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;_be&quot;</span><span class="p">)</span>
            <span class="n">cir_el2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cir_el2</span><span class="p">,</span> <span class="n">cir_el</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;_bc&quot;</span><span class="p">)</span>
            <span class="n">cir_el2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cir_el2</span><span class="p">,</span> <span class="n">cir_el</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">:])</span>

            <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">cir_nd2</span> <span class="o">=</span> <span class="n">cir_nd2</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">i</span> <span class="o">+</span> <span class="n">paso</span><span class="p">,</span> <span class="p">:]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cir_nd2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
            <span class="n">lista1</span> <span class="o">=</span> <span class="p">[</span><span class="n">cir_nd</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">cir_nd</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">lista2</span> <span class="o">=</span> <span class="p">[</span><span class="n">cir_nd</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">cir_nd</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">cir_nd2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cir_nd2</span><span class="p">,</span> <span class="n">lista1</span><span class="p">)</span>
            <span class="n">cir_nd2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cir_nd2</span><span class="p">,</span> <span class="n">lista2</span><span class="p">)</span>
            <span class="n">cir_nd2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cir_nd2</span><span class="p">,</span> <span class="n">cir_nd</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:,</span> <span class="p">:])</span>
            <span class="c1"># print(len(cir_nd2))</span>

            <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">cir_val2</span> <span class="o">=</span> <span class="n">cir_val2</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span> <span class="n">i</span> <span class="o">+</span> <span class="n">paso</span><span class="p">,</span> <span class="p">:]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cir_val2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
            <span class="n">cir_val2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cir_val2</span><span class="p">,</span> <span class="n">cir_val</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">cir_val2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cir_val2</span><span class="p">,</span> <span class="n">cir_val</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">cir_val2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cir_val2</span><span class="p">,</span> <span class="n">cir_val</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:,</span> <span class="p">:])</span>
            <span class="c1"># print(len(cir_val2))</span>

            <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">cir_ctr2</span> <span class="o">=</span> <span class="n">cir_ctr2</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span> <span class="n">i</span> <span class="o">+</span> <span class="n">paso</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cir_ctr2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
            <span class="n">cir_ctr2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cir_ctr2</span><span class="p">,</span> <span class="n">cir_ctr</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">cir_ctr2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cir_ctr2</span><span class="p">,</span> <span class="n">cir_ctr</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">cir_ctr2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cir_ctr2</span><span class="p">,</span> <span class="n">cir_ctr</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">:])</span>
            <span class="c1"># print(len(cir_ctr2))</span>

            <span class="c1"># behin baño gehiotan balinbadao Q bat dimentsio bat baño</span>
            <span class="c1"># haundigoko matrizek berriro matrize forman jarri beaiteu,</span>
            <span class="c1"># ordun hemen reshaipeatu beaiteu eta ez return en</span>
            <span class="n">cir_nd2</span> <span class="o">=</span> <span class="n">cir_nd2</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cir_el2</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">cir_nd</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="n">cir_val2</span> <span class="o">=</span> <span class="n">cir_val2</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cir_el2</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">cir_val</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

            <span class="n">paso</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="c1"># A:</span>

    <span class="n">cir_el3</span> <span class="o">=</span> <span class="n">cir_el2</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">cir_nd3</span> <span class="o">=</span> <span class="n">cir_nd2</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">cir_val3</span> <span class="o">=</span> <span class="n">cir_val2</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">cir_ctr3</span> <span class="o">=</span> <span class="n">cir_ctr2</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="n">paso</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cir_el2</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">cir_el2</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;A&quot;</span><span class="p">:</span>

            <span class="c1"># if cir_nd2[i][3] != 0:</span>
            <span class="c1">#     ref = True</span>
            <span class="c1"># else:</span>
            <span class="c1">#     ref = False</span>

            <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">cir_el3</span> <span class="o">=</span> <span class="n">cir_el3</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span> <span class="n">i</span> <span class="o">+</span> <span class="n">paso</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cir_el3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
            <span class="n">cir_el3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cir_el3</span><span class="p">,</span> <span class="n">cir_el2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;_in&quot;</span><span class="p">)</span>
            <span class="n">cir_el3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cir_el3</span><span class="p">,</span> <span class="n">cir_el2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;_out&quot;</span><span class="p">)</span>
            <span class="c1"># if ref: cir_el3 = np.append(cir_el3, cir_el[i] + &quot;_ref&quot;)</span>
            <span class="n">cir_el3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cir_el3</span><span class="p">,</span> <span class="n">cir_el2</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">:])</span>

            <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">cir_nd3</span> <span class="o">=</span> <span class="n">cir_nd3</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span> <span class="n">i</span> <span class="o">+</span> <span class="n">paso</span><span class="p">,</span> <span class="p">:]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cir_nd3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
            <span class="n">lista1</span> <span class="o">=</span> <span class="p">[</span><span class="n">cir_nd2</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">cir_nd2</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">lista2</span> <span class="o">=</span> <span class="p">[</span><span class="n">cir_nd2</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> <span class="n">cir_nd2</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">cir_nd3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cir_nd3</span><span class="p">,</span> <span class="n">lista1</span><span class="p">)</span>
            <span class="n">cir_nd3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cir_nd3</span><span class="p">,</span> <span class="n">lista2</span><span class="p">)</span>
            <span class="c1"># if ref:</span>
            <span class="c1">#    lista3 =</span>
            <span class="c1">#    cir_nd3 = np.append(cir_nd3, lista3)</span>
            <span class="n">cir_nd3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cir_nd3</span><span class="p">,</span> <span class="n">cir_nd2</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:,</span> <span class="p">:])</span>
            <span class="c1"># print(len(cir_nd3))</span>

            <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">cir_val3</span> <span class="o">=</span> <span class="n">cir_val3</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span> <span class="n">i</span> <span class="o">+</span> <span class="n">paso</span><span class="p">,</span> <span class="p">:]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cir_val3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
            <span class="n">cir_val3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cir_val3</span><span class="p">,</span> <span class="n">cir_val2</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">cir_val3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cir_val3</span><span class="p">,</span> <span class="n">cir_val2</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="c1"># if ref: cir_val3 = np.append(cir_val3, cir_val2[i])</span>
            <span class="n">cir_val3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cir_val3</span><span class="p">,</span> <span class="n">cir_val2</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:,</span> <span class="p">:])</span>
            <span class="c1"># print(len(cir_val3))</span>

            <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">cir_ctr3</span> <span class="o">=</span> <span class="n">cir_ctr3</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span> <span class="n">i</span> <span class="o">+</span> <span class="n">paso</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cir_ctr3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
            <span class="n">cir_ctr3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cir_ctr3</span><span class="p">,</span> <span class="n">cir_ctr2</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">cir_ctr3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cir_ctr3</span><span class="p">,</span> <span class="n">cir_ctr2</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="c1"># if ref: cir_ctr3 = np.append(cir_ctr3, cir_ctr2[i])</span>
            <span class="n">cir_ctr3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cir_ctr3</span><span class="p">,</span> <span class="n">cir_ctr2</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">:])</span>
            <span class="c1"># print(len(cir_ctr3))</span>

            <span class="n">cir_nd3</span> <span class="o">=</span> <span class="n">cir_nd3</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cir_el3</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">cir_nd</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="n">cir_val3</span> <span class="o">=</span> <span class="n">cir_val3</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cir_el3</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">cir_val</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

            <span class="n">paso</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">return</span> <span class="n">cir_el3</span><span class="p">,</span> <span class="n">cir_nd3</span><span class="p">,</span> <span class="n">cir_val3</span><span class="p">,</span> <span class="n">cir_ctr3</span></div>


<span class="c1"># 3) HAUSNARKETA: Nodo zerrenda eta adar kopurua (b)</span>
<div class="viewcode-block" id="nodo_ezberdinak"><a class="viewcode-back" href="../../zlel.html#zlel.zlel_p1.nodo_ezberdinak">[docs]</a><span class="k">def</span> <span class="nf">nodo_ezberdinak</span><span class="p">(</span><span class="n">cir_nd</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    This function returns the number of nodes of the circuit.</span>

<span class="sd">    Args:</span>
<span class="sd">        cir_nd : list</span>

<span class="sd">    Returns:</span>
<span class="sd">        list. Returns a list which contains the nodes of the circuit.</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">cir_nd</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">])</span></div>


<div class="viewcode-block" id="nodo_adar_kop"><a class="viewcode-back" href="../../zlel.html#zlel.zlel_p1.nodo_adar_kop">[docs]</a><span class="k">def</span> <span class="nf">nodo_adar_kop</span><span class="p">(</span><span class="n">cir_el_luz</span><span class="p">,</span> <span class="n">nodo_ezb</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Returns the number of nodes and branches of the circuit.</span>

<span class="sd">    Args:</span>
<span class="sd">        cir_el_luz : list</span>
<span class="sd">        nodo_ezb : list</span>

<span class="sd">    Returns:</span>
<span class="sd">        integer, integer</span>
<span class="sd">        The first integer specifies the number of nodes of the circuit,</span>
<span class="sd">        and the second integer specifies the number of branches.</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">nodo_ezb</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">cir_el_luz</span><span class="p">)</span></div>


<div class="viewcode-block" id="elementu_kop"><a class="viewcode-back" href="../../zlel.html#zlel.zlel_p1.elementu_kop">[docs]</a><span class="k">def</span> <span class="nf">elementu_kop</span><span class="p">(</span><span class="n">cir_el</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">cir_el</span><span class="p">)</span></div>


<span class="c1"># 4) Intzidentzia matrizea eta murriztetako intzidentzia matrizea Aa eta A</span>
<div class="viewcode-block" id="Aa_eta_A"><a class="viewcode-back" href="../../zlel.html#zlel.zlel_p1.Aa_eta_A">[docs]</a><span class="k">def</span> <span class="nf">Aa_eta_A</span><span class="p">(</span><span class="n">cir_nd_luz</span><span class="p">,</span> <span class="n">nodo_ezb</span><span class="p">,</span> <span class="n">adar_kop</span><span class="p">,</span> <span class="n">nodo_ezb_kop</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    This function calculates the incidence matrix and the asociated incidence</span>
<span class="sd">    matrix. A zero-filled matrix is created and then gets the neighboring</span>
<span class="sd">    nodes of every branch, taking into account which one is the positive</span>
<span class="sd">    and which is the negative. So is the Aa matrix created. And then the</span>
<span class="sd">    first line is substracted (the 0 node) to get the A matrix.</span>

<span class="sd">    Args:</span>
<span class="sd">        cir_nd_luz : list</span>
<span class="sd">        nodo_ezb : list</span>
<span class="sd">        adar_kop : list</span>
<span class="sd">        nodo_ezb_kop : list</span>

<span class="sd">    Returns:</span>
<span class="sd">        Aa : matrix</span>
<span class="sd">        Asociated incidence matrix.</span>
<span class="sd">        A : matrix</span>
<span class="sd">        Incidence matrix.</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1"># Aa = [[0.0 for zutabe_kop in range(adar_kop)]</span>
    <span class="c1">#      for ilara_kop in range(nodo_ezb_kop)]</span>
    <span class="n">Aa</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">zutabe_kop</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">adar_kop</span><span class="p">)]</span>
          <span class="k">for</span> <span class="n">ilara_kop</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nodo_ezb_kop</span><span class="p">)]</span>
    <span class="n">Aa</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Aa</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">adar_kop</span><span class="p">):</span>
        <span class="n">plus</span> <span class="o">=</span> <span class="n">cir_nd_luz</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
        <span class="n">minus</span> <span class="o">=</span> <span class="n">cir_nd_luz</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>

        <span class="n">Aa</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">nodo_ezb</span> <span class="o">==</span> <span class="n">plus</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="o">+</span><span class="mi">1</span>
        <span class="n">Aa</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">nodo_ezb</span> <span class="o">==</span> <span class="n">minus</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

    <span class="c1"># suposatzea nodok ordenatuta daudela zenbakiagatik</span>
    <span class="c1"># ordun erreferentzia nodoa lenengo ilara izangoa</span>
    <span class="c1"># bestela, beste bat bada, zenbatgarren indizen daon jakinda</span>
    <span class="c1"># cir_el luzatun lerro guztik hartzeiteu hoi izan ezik</span>
    <span class="c1"># [0 : i, :] eta gero [i + 1 : , :] iñez eta bukaeran</span>
    <span class="c1"># reshape(nodo_ezb_kop - 1, adar_kop)</span>
    <span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Aa</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="p">:])</span>

    <span class="k">return</span> <span class="n">Aa</span><span class="p">,</span> <span class="n">A</span></div>


<span class="c1"># 5) ERROREEN KONTROLA</span>
<div class="viewcode-block" id="errore_kontrola"><a class="viewcode-back" href="../../zlel.html#zlel.zlel_p1.errore_kontrola">[docs]</a><span class="k">def</span> <span class="nf">errore_kontrola</span><span class="p">(</span><span class="n">Aa</span><span class="p">,</span> <span class="n">cir</span><span class="p">,</span> <span class="n">cir_el_luz</span><span class="p">,</span> <span class="n">cir_nd_luz</span><span class="p">,</span> <span class="n">cir_val_luz</span><span class="p">,</span> <span class="n">nodo_ezb</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    This function checks if the given circuit contains any errors:</span>
<span class="sd">    A line in the .cir document does not contain 9 lines</span>
<span class="sd">    The reference node is not specifies</span>
<span class="sd">    The sum of a column of the asociated incidence matrix is not 0</span>
<span class="sd">    There are voltage sources of different values in parallel</span>
<span class="sd">    There are current sources of different values in series</span>

<span class="sd">    Args:</span>
<span class="sd">        Aa : matrix</span>
<span class="sd">        cir : matrix</span>
<span class="sd">        cir_el_luz : list</span>
<span class="sd">        cir_nd_luz : list</span>
<span class="sd">        cir_val_luz : list</span>
<span class="sd">        nodo_ezb : list</span>
<span class="sd">        b : integer. Number of branches.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool</span>
<span class="sd">        True is returned if the .cir document contains no errors.</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1"># 5a: (cir fitxategian informazio egokia)</span>

    <span class="k">for</span> <span class="n">lerroa</span> <span class="ow">in</span> <span class="n">cir</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lerroa</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">9</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s2">&quot;.cir FITXATEGIKO LERRO BATEK EZ DITU 9 OSAGAI!!&quot;</span><span class="p">)</span>

    <span class="c1"># 5b: (erreferentzia nodoa dago.)</span>
    <span class="c1"># if 0 not in nodo_ezb:</span>
    <span class="k">if</span> <span class="n">nodo_ezb</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s2">&quot;Reference node </span><span class="se">\&quot;</span><span class="s2">0</span><span class="se">\&quot;</span><span class="s2"> is not defined in the circuit.&quot;</span><span class="p">)</span>

    <span class="c1"># 5d: (ez dago balio desberdineko tentsio iturririk paraleloan)</span>
    <span class="n">av</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">cir_el_luz</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;V&quot;</span> <span class="ow">or</span> <span class="n">cir_el_luz</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;B&quot;</span><span class="p">:</span>
            <span class="n">av</span><span class="p">[</span><span class="n">cir_el_luz</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span><span class="n">cir_nd_luz</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                                 <span class="n">cir_nd_luz</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
                                 <span class="n">cir_val_luz</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
    <span class="n">gako_v_lista</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">av</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="n">balio_v_lista</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">av</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">gako_v_lista</span><span class="p">)):</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">gako_v_lista</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">balio_v_lista</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="p">(</span><span class="n">balio_v_lista</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span>
                                       <span class="n">balio_v_lista</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span>
                                       <span class="n">balio_v_lista</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span>
                                       <span class="n">balio_v_lista</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">!=</span>
                                       <span class="n">balio_v_lista</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">2</span><span class="p">]):</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s2">&quot;Parallel V sources at branches &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; and &quot;</span>
                         <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span><span class="p">)</span>
                <span class="c1"># sys.exit(str(j) + &quot;. eta &quot; + str(k) + &quot;. adarretan balio \</span>
                <span class="c1">#         ezberdineko tentsio iturriak paraleloan&quot;)</span>
            <span class="k">elif</span> <span class="p">(</span><span class="n">balio_v_lista</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">balio_v_lista</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span>
                  <span class="n">balio_v_lista</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">balio_v_lista</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span>
                  <span class="n">balio_v_lista</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">!=</span> <span class="o">-</span><span class="n">balio_v_lista</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">2</span><span class="p">]):</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s2">&quot;Parallel V sources at branches &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; and &quot;</span>
                         <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span><span class="p">)</span>
                <span class="c1"># sys.exit(str(j) + &quot;. eta &quot; + str(k) + &quot;. adarretan balio\</span>
                <span class="c1">#         ezberdineko tentsio iturriak paraleloan&quot;)</span>

    <span class="c1"># 5e: (ez dago balio desberdineko korronte iturririk serian)</span>
    <span class="c1"># korronte elementuen nododak eta balioak ai-n gorde</span>
    <span class="n">hiztegi</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">aztertzeko_nodoak</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">nodo_ezb</span><span class="p">:</span>
        <span class="n">elementu_lista</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">b</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">cir_nd_luz</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">j</span> <span class="ow">or</span> <span class="n">cir_nd_luz</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">j</span><span class="p">:</span>
                <span class="n">elementu_lista</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cir_el_luz</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">hiztegi</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">elementu_lista</span>
    <span class="n">nodoak</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">hiztegi</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="n">elementuak</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">hiztegi</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
    <span class="c1"># print(&#39;hiztegi&#39;, hiztegi)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">nodoak</span><span class="p">)):</span>
        <span class="n">kont</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">elementuak</span><span class="p">[</span><span class="n">i</span><span class="p">])):</span>
            <span class="k">if</span> <span class="n">elementuak</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;I&#39;</span><span class="p">:</span>
                <span class="n">kont</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">kont</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">elementuak</span><span class="p">[</span><span class="n">i</span><span class="p">]):</span>
            <span class="n">aztertzeko_nodoak</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nodoak</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

    <span class="n">batura</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">aztertzeko_nodoak</span><span class="p">)):</span>
        <span class="n">nn</span> <span class="o">=</span> <span class="n">aztertzeko_nodoak</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">b</span><span class="p">):</span>
            <span class="n">batura</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">Aa</span><span class="p">[</span><span class="n">nn</span><span class="p">][</span><span class="n">m</span><span class="p">])</span><span class="o">*</span><span class="nb">int</span><span class="p">(</span><span class="n">cir_val_luz</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">batura</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s2">&quot;I sources in series at node &quot;</span>
                     <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">nn</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span><span class="p">)</span>

    <span class="c1"># 5c: (ez dago konexio bakarreko nodorik.)</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">nodo_ezb</span><span class="p">)):</span>
        <span class="n">batura</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">b</span><span class="p">):</span>
            <span class="n">batura</span> <span class="o">+=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Aa</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">batura</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s2">&quot;Node &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">nodo_ezb</span><span class="p">[</span><span class="n">j</span><span class="p">])</span><span class="o">+</span><span class="s2">&quot; is floating.&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="print_incidence_matrix_textua"><a class="viewcode-back" href="../../zlel.html#zlel.zlel_p1.print_incidence_matrix_textua">[docs]</a><span class="k">def</span> <span class="nf">print_incidence_matrix_textua</span><span class="p">(</span><span class="n">Aa</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    This function creates a string containing the incidence matrix.</span>
<span class="sd">    The text is then printed in the .out files which need the incidence</span>
<span class="sd">    matrix to be specified.</span>

<span class="sd">    Returns:</span>
<span class="sd">        textua : string</span>
<span class="sd">        The string contains the sentence &#39;Indicence Matrix&#39; and then</span>
<span class="sd">        the string representation of the matrix.</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">textua</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Incidence Matrix: </span><span class="se">\n</span><span class="s2">&quot;</span>

    <span class="c1"># for i in range(len(Aa)):</span>
    <span class="c1">#     lerroa = str(Aa[i])</span>
    <span class="c1">#     if i == len(Aa) - 1:</span>
    <span class="c1">#         textua += &quot; &quot; + lerroa + &quot;]&quot;</span>
    <span class="c1">#     elif i == 0:</span>
    <span class="c1">#         textua += &quot;[&quot; + lerroa + &quot;\n&quot;</span>
    <span class="c1">#     else:</span>
    <span class="c1">#         textua += &quot; &quot; + lerroa + &quot;\n&quot;</span>

    <span class="n">textua</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">Aa</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">textua</span></div>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>

        <span class="c1"># filename = &quot;../cirs/all/0_zlel_no_elements_def.cir&quot;  # ONDO</span>
        <span class="c1"># filename = &quot;../cirs/all/0_zlel_node.cir&quot;  # ONDO</span>
        <span class="c1"># filename = &quot;../cirs/all/0_zlel_node_float.cir&quot;  # ONDO</span>

        <span class="c1"># filename = &quot;../cirs/all/0_zlel_OPAMP.cir&quot;  # ONDO, baño .out hutsik</span>
        <span class="c1"># filename = &quot;../cirs/all/0_zlel_parallel_V_I.cir&quot;  # ONDO</span>
        <span class="c1"># filename = &quot;../cirs/all/0_zlel_parallel_V_II.cir&quot;  # ONDO</span>
        <span class="c1"># filename = &quot;../cirs/all/0_zlel_parallel_V_III.cir&quot;  # ONDO</span>
        <span class="c1"># filename = &quot;../cirs/all/0_zlel_parallel_V_IV.cir&quot;  # ONDO</span>
        <span class="c1"># filename = &quot;../cirs/all/0_zlel_parallel_V_V.cir&quot;  # ONDO, .out hutsik</span>

        <span class="c1"># filename = &quot;../cirs/all/0_zlel_serial_I_I.cir&quot;  # ONDO</span>
        <span class="c1"># filename = &quot;../cirs/all/0_zlel_serial_I_II.cir&quot; # ONDO</span>
        <span class="c1"># filename = &quot;../cirs/all/0_zlel_serial_I_III.cir&quot; # ONDO, .out hutsik</span>
        <span class="c1"># filename = &quot;../cirs/all/0_zlel_serial_I_IV.cir&quot; # ONDO, .out hutsik</span>
        <span class="c1"># filename = &quot;../cirs/all/0_zlel_serial_I_V.cir&quot; # ONDO</span>
        <span class="c1"># filename = &quot;../cirs/all/0_zlel_serial_I_VI.cir&quot; # ONDO, .out hutsik</span>
        <span class="c1"># filename = &quot;../cirs/all/0_zlel_serial_I_VII.cir&quot; # ONDO, .out hutsik</span>

        <span class="c1"># filename = &quot;../cirs/all/0_zlel_tabs.cir&quot; # ONDO, .out hutsik</span>
        <span class="c1"># filename = &quot;../cirs/all/0_zlel_V_R.cir&quot; # ONDO, .out hutsik</span>
        <span class="c1"># filename = &quot;../cirs/all/0_zlel_V_R_Q.cir&quot; # ONDO, .out hutsik</span>

        <span class="c1"># Parse the circuit</span>
        <span class="p">[</span><span class="n">cir_el</span><span class="p">,</span> <span class="n">cir_nd</span><span class="p">,</span> <span class="n">cir_val</span><span class="p">,</span> <span class="n">cir_ctr</span><span class="p">,</span> <span class="n">cir</span><span class="p">]</span> <span class="o">=</span> <span class="n">cir_parser</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="p">[</span><span class="n">cir_el_luz</span><span class="p">,</span> <span class="n">cir_nd_luz</span><span class="p">,</span> <span class="n">cir_val_luz</span><span class="p">,</span> <span class="n">cir_ctr_luz</span><span class="p">]</span> <span class="o">=</span> <span class="n">luzatu</span><span class="p">(</span>
            <span class="n">cir_el</span><span class="p">,</span> <span class="n">cir_nd</span><span class="p">,</span> <span class="n">cir_val</span><span class="p">,</span> <span class="n">cir_ctr</span><span class="p">)</span>
        <span class="n">nodo_ezb</span> <span class="o">=</span> <span class="n">nodo_ezberdinak</span><span class="p">(</span><span class="n">cir_nd</span><span class="p">)</span>
        <span class="n">n</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">nodo_adar_kop</span><span class="p">(</span><span class="n">cir_el_luz</span><span class="p">,</span> <span class="n">nodo_ezb</span><span class="p">)</span>
        <span class="n">el_kop</span> <span class="o">=</span> <span class="n">elementu_kop</span><span class="p">(</span><span class="n">cir_el</span><span class="p">)</span>

        <span class="n">Aa</span><span class="p">,</span> <span class="n">A</span> <span class="o">=</span> <span class="n">Aa_eta_A</span><span class="p">(</span><span class="n">cir_nd_luz</span><span class="p">,</span> <span class="n">nodo_ezb</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>

        <span class="n">print_cir_info</span><span class="p">(</span><span class="n">cir_el_luz</span><span class="p">,</span> <span class="n">cir_nd_luz</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">nodo_ezb</span><span class="p">,</span> <span class="n">el_kop</span><span class="p">)</span>

    <span class="c1">#    print()</span>
    <span class="c1">#    print(&quot;Incidence Matrix :&quot;)</span>
    <span class="c1">#    print(Aa)</span>
    <span class="c1">#    print(cir_val_luz)</span>
    <span class="c1">#    print(cir_nd_luz)</span>
    <span class="c1">#    print(cir_nd[4][0])</span>
    <span class="c1">#    print(cir_el_luz)</span>

        <span class="n">errore_kontrola</span><span class="p">(</span><span class="n">Aa</span><span class="p">,</span> <span class="n">cir</span><span class="p">,</span> <span class="n">cir_el_luz</span><span class="p">,</span> <span class="n">cir_nd_luz</span><span class="p">,</span> <span class="n">cir_val_luz</span><span class="p">,</span>
                        <span class="n">nodo_ezb</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">ZLEL</a></h1>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../modules.html">zlel</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, June Irurzun (juneirurzun.ehu@gmail.com), Iñaki Lakunza (ialakunza@gmail.com).
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 5.0.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    

    
  </body>
</html>